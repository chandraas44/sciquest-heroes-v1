import"./config-CMljicwL.js";import{getStoryList as w,logAnalyticsEvent as _,isUsingStoryMocks as C,getStoryProgressSummary as x}from"./story-services-CTDJFou-.js";import{_ as d}from"./preload-helper-D7HrI6pR.js";import"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/+esm";const i=document.getElementById("storiesGrid"),m=document.getElementById("storyListEmpty"),u=document.getElementById("offlineBanner"),I=document.getElementById("storyCardTemplate");function l(){if(!u)return;const t=C()||navigator.onLine===!1;u.classList.toggle("hidden",!t)}function B(t){var s;const e=I.content.cloneNode(!0),n=e.querySelector("[data-cover]"),a=e.querySelector("[data-topic]"),E=e.querySelector("[data-title]"),h=e.querySelector("[data-summary]"),f=e.querySelector("[data-readingLevel]"),L=e.querySelector("[data-estimatedTime]"),r=e.querySelector("[data-progressLabel]"),S=e.querySelector("[data-openStory]");n.src=t.coverUrl||"/images/placeholder-story.png",n.alt=t.title,a.textContent=t.topicTag||"Science",E.textContent=t.title,h.textContent=t.summary||"Tap to open this adventure.",f.textContent=t.readingLevel||"Mixed Ages",L.textContent=t.estimatedTime||"5 min read";const o=x(t.id),c=((s=t.panels)==null?void 0:s.length)??t.panel_count??6;if(o!=null&&o.completedAt)r.textContent="Completed";else if((o==null?void 0:o.lastPanelIndex)>0){const v=Math.min(o.lastPanelIndex+1,c);r.textContent=`Panel ${v} of ${c}`}else r.textContent="Not started";return S.addEventListener("click",()=>{window.location.href=`./story.html?storyId=${encodeURIComponent(t.id)}`}),e}function T(t){if(i.innerHTML="",!t.length){m.classList.remove("hidden");return}m.classList.add("hidden"),t.forEach(e=>{i.appendChild(B(e))})}async function P(){try{const t=await w();T(t),await _("stories_list_viewed",{storyCount:t.length})}catch(t){console.error("[stories] Unable to load stories",t),i.innerHTML='<div class="col-span-2 text-center text-red-500 font-semibold">Unable to load stories right now.</div>'}}l();window.addEventListener("online",l);window.addEventListener("offline",l);P();const p=async()=>{try{const{createClient:t}=await d(async()=>{const{createClient:n}=await import("https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/+esm");return{createClient:n}},[]),{supabaseConfig:e}=await d(async()=>{const{supabaseConfig:n}=await import("./config-CMljicwL.js");return{supabaseConfig:n}},[]);if(e!=null&&e.url&&(e!=null&&e.anonKey)){const n=t(e.url,e.anonKey),{error:a}=await n.auth.signOut();if(a)throw a}}catch{console.log("Supabase logout skipped (mock mode)")}localStorage.clear(),sessionStorage.clear(),window.location.href="../auth/auth.html"};var y;(y=document.getElementById("logoutBtn"))==null||y.addEventListener("click",p);var g;(g=document.getElementById("logoutBtnMobile"))==null||g.addEventListener("click",p);
