import"./config-N_0HKkEA.js";import{getStoryList as L,logAnalyticsEvent as S,isUsingStoryMocks as v,getStoryProgressSummary as w}from"./story-services-RJgnPI-H.js";import"./logo-handler-BTCRg4Zu.js";import{_ as c}from"./preload-helper-BXl3LOEh.js";import"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/+esm";const i=document.getElementById("storiesGrid"),d=document.getElementById("storyListEmpty"),m=document.getElementById("offlineBanner"),C=document.getElementById("storyCardTemplate");function l(){if(!m)return;const e=v()||navigator.onLine===!1;m.classList.toggle("hidden",!e)}function _(e){const t=C.content.cloneNode(!0),n=t.querySelector("[data-cover]"),o=t.querySelector("[data-topic]"),g=t.querySelector("[data-title]"),p=t.querySelector("[data-summary]"),y=t.querySelector("[data-readingLevel]"),f=t.querySelector("[data-estimatedTime]"),r=t.querySelector("[data-progressLabel]"),E=t.querySelector("[data-openStory]");n.src=e.coverUrl||"/images/placeholder-story.png",n.alt=e.title,o.textContent=e.topicTag||"Science",g.textContent=e.title,p.textContent=e.summary||"Tap to open this adventure.",y.textContent=e.readingLevel||"Mixed Ages",f.textContent=e.estimatedTime||"5 min read";const a=w(e.id),s=e.panels?.length??e.panel_count??6;if(a?.completedAt)r.textContent="Completed";else if(a?.lastPanelIndex>0){const h=Math.min(a.lastPanelIndex+1,s);r.textContent=`Panel ${h} of ${s}`}else r.textContent="Not started";return E.addEventListener("click",()=>{window.location.href=`./story.html?storyId=${encodeURIComponent(e.id)}`}),t}function x(e){if(i.innerHTML="",!e.length){d.classList.remove("hidden");return}d.classList.add("hidden"),e.forEach(t=>{i.appendChild(_(t))})}async function I(){try{const e=await L();x(e),await S("stories_list_viewed",{storyCount:e.length})}catch(e){console.error("[stories] Unable to load stories",e),i.innerHTML='<div class="col-span-2 text-center text-red-500 font-semibold">Unable to load stories right now.</div>'}}l();window.addEventListener("online",l);window.addEventListener("offline",l);I();const u=async()=>{try{const{createClient:e}=await c(async()=>{const{createClient:n}=await import("https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/+esm");return{createClient:n}},[]),{supabaseConfig:t}=await c(async()=>{const{supabaseConfig:n}=await import("./config-N_0HKkEA.js");return{supabaseConfig:n}},[]);if(t?.url&&t?.anonKey){const n=e(t.url,t.anonKey),{error:o}=await n.auth.signOut();if(o)throw o}}catch{console.log("Supabase logout skipped (mock mode)")}localStorage.clear(),sessionStorage.clear(),window.location.href="../auth/auth.html"};document.getElementById("logoutBtn")?.addEventListener("click",u);document.getElementById("logoutBtnMobile")?.addEventListener("click",u);
