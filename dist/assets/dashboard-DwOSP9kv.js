import{createClient as d}from"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/+esm";import{supabaseConfig as s}from"./config-N_0HKkEA.js";const h=s.url,m=s.anonKey,n=d(h,m),l=document.getElementById("userMenuTrigger"),c=document.getElementById("dropdownMenu"),p=document.getElementById("logoutBtn"),o=document.getElementById("userAvatar"),f=document.getElementById("userName");let i=null;async function g(){const{data:{session:t}}=await n.auth.getSession();if(!t){window.location.href="../auth/auth.html";return}const{data:e,error:r}=await n.from("user_profiles").select("*").eq("id",t.user.id).maybeSingle();if(r){console.error("Error loading profile:",r);return}if(!e){window.location.href="../auth/auth.html";return}const a=window.location.pathname;if(a.includes("parent-dashboard.html")&&e.account_type!=="parent"){e.account_type==="teacher"?window.location.href="teacher-dashboard.html":e.account_type==="student"?window.location.href="student-dashboard.html":window.location.href="../index.html";return}if(a.includes("teacher-dashboard.html")&&e.account_type!=="teacher"){e.account_type==="parent"?window.location.href="parent-dashboard.html":e.account_type==="student"?window.location.href="student-dashboard.html":window.location.href="../index.html";return}i=e.account_type,w(t.user.id)}async function w(t){try{const{data:e,error:r}=await n.from("user_profiles").select("*").eq("id",t).maybeSingle();if(r)throw r;if(e){let a;if(e.account_type==="parent"||e.account_type==="teacher"?a=e.email:a=e.first_name||e.full_name||e.username||e.email,f.textContent=a,e.avatar_url)o.innerHTML=`<img src="${e.avatar_url}" alt="Avatar">`;else if(e.email&&(e.account_type==="parent"||e.account_type==="teacher"))o.textContent=e.email.charAt(0).toUpperCase();else if(e.first_name)o.textContent=e.first_name.charAt(0).toUpperCase();else if(e.username)o.textContent=e.username.charAt(0).toUpperCase();else{const u=e.account_type.charAt(0).toUpperCase();o.textContent=u}}}catch(e){console.error("Error loading profile:",e)}}l.addEventListener("click",t=>{t.stopPropagation(),c.classList.toggle("show")});document.addEventListener("click",t=>{!l.contains(t.target)&&!c.contains(t.target)&&c.classList.remove("show")});p.addEventListener("click",async()=>{try{const{error:t}=await n.auth.signOut();if(t)throw t;localStorage.clear(),sessionStorage.clear();const e=i?`../auth/auth.html?type=${i}&mode=login`:"../auth/auth.html";window.location.href=e}catch(t){console.error("Logout error:",t),alert("Failed to logout. Please try again.")}});g();
