import{createClient as u}from"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/+esm";import{s as c}from"./config-4EZbmldV.js";const m=c.url,d=c.anonKey,o=u(m,d),i=document.getElementById("userMenuTrigger"),n=document.getElementById("dropdownMenu"),p=document.getElementById("logoutBtn"),a=document.getElementById("userAvatar"),g=document.getElementById("userName");async function f(){const{data:{session:t}}=await o.auth.getSession();if(!t){window.location.href="auth.html";return}h(t.user.id)}async function h(t){try{const{data:e,error:s}=await o.from("user_profiles").select("*").eq("id",t).maybeSingle();if(s)throw s;if(e){let r;if(e.account_type==="parent"||e.account_type==="teacher"?r=e.email:r=e.first_name||e.full_name||e.username||e.email,g.textContent=r,e.avatar_url)a.innerHTML=`<img src="${e.avatar_url}" alt="Avatar">`;else if(e.email&&(e.account_type==="parent"||e.account_type==="teacher"))a.textContent=e.email.charAt(0).toUpperCase();else if(e.first_name)a.textContent=e.first_name.charAt(0).toUpperCase();else if(e.username)a.textContent=e.username.charAt(0).toUpperCase();else{const l=e.account_type.charAt(0).toUpperCase();a.textContent=l}}}catch(e){console.error("Error loading profile:",e)}}i.addEventListener("click",t=>{t.stopPropagation(),n.classList.toggle("show")});document.addEventListener("click",t=>{!i.contains(t.target)&&!n.contains(t.target)&&n.classList.remove("show")});p.addEventListener("click",async()=>{try{const{error:t}=await o.auth.signOut();if(t)throw t;localStorage.clear(),sessionStorage.clear(),window.location.href="auth.html"}catch(t){console.error("Logout error:",t),alert("Failed to logout. Please try again.")}});f();
