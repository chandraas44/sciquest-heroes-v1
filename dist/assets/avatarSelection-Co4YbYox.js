import{s as d}from"./config-4EZbmldV.js";import{createClient as m}from"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/+esm";const u=d.url,g=d.anonKey,s=m(u,g),l=[{id:"bolt",name:"Bolt",image:"assets/avatars/Bolt.png"},{id:"echo",name:"Echo",image:"assets/avatars/Echo.png"},{id:"finn",name:"Finn",image:"assets/avatars/Finn.png"},{id:"kira",name:"Kira",image:"assets/avatars/Kira.png"},{id:"leo",name:"Leo",image:"assets/avatars/Leo.png"},{id:"max",name:"Max",image:"assets/avatars/Max.png"},{id:"ruby",name:"Ruby",image:"assets/avatars/Ruby.png"},{id:"stella",name:"Stella",image:"assets/avatars/Stella_flora.png"},{id:"rex",name:"Rex",image:"assets/avatars/Dino_rexexplorer.png"}];let r=null;const v=document.getElementById("avatarGrid"),n=document.getElementById("confirmBtn"),o=document.getElementById("confirmBtnText"),f=document.getElementById("skipBtn"),i=document.getElementById("errorMessage");function c(a){i.textContent=a,i.classList.add("show"),window.scrollTo({top:0,behavior:"smooth"})}function p(){i.classList.remove("show")}function h(){l.forEach(a=>{const e=document.createElement("div");e.className="avatar-card",e.dataset.avatarId=a.id,e.innerHTML=`
            <div class="avatar-image-wrapper">
                <img src="${a.image}" alt="${a.name}" onerror="this.src='assets/avatars/Bolt.png'">
            </div>
            <div class="avatar-name">${a.name}</div>
        `,e.addEventListener("click",()=>w(a.id)),v.appendChild(e)})}function w(a){p(),document.querySelectorAll(".avatar-card").forEach(t=>{t.classList.remove("selected")});const e=document.querySelector(`[data-avatar-id="${a}"]`);e&&(e.classList.add("selected"),r=l.find(t=>t.id===a),n.disabled=!1)}async function y(a){try{const{data:{session:e}}=await s.auth.getSession();if(!e)throw new Error("No active session. Please log in again.");const{error:t}=await s.from("user_profiles").update({avatar_url:a}).eq("id",e.user.id);if(t)throw t;return!0}catch(e){throw console.error("Error saving avatar:",e),e}}n.addEventListener("click",async()=>{if(!r){c("Please select an avatar");return}n.disabled=!0,o.innerHTML='<span class="loading-spinner"></span>Saving...';try{await y(r.image),localStorage.removeItem("newStudentSignup"),setTimeout(()=>{window.location.href="index.html"},500)}catch{c("Failed to save avatar. Please try again."),n.disabled=!1,o.textContent="Confirm Selection"}});f.addEventListener("click",()=>{localStorage.removeItem("newStudentSignup"),window.location.href="index.html"});async function E(){const{data:{session:a}}=await s.auth.getSession();if(!a){window.location.href="auth.html";return}const{data:e}=await s.from("user_profiles").select("account_type").eq("id",a.user.id).maybeSingle();if(e&&e.account_type!=="student"){window.location.href="index.html";return}}E();h();
