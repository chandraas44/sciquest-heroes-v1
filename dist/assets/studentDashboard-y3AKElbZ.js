import{s as i}from"./config-ClyacVFi.js";import{createClient as l}from"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/+esm";const d=i.url,u=i.anonKey,o=l(d,u),c=document.getElementById("userMenuTrigger"),s=document.getElementById("dropdownMenu"),m=document.getElementById("logoutBtn"),n=document.getElementById("userAvatar"),g=document.getElementById("userName"),h=document.getElementById("welcomeMessage"),r=document.getElementById("avatarDisplay"),f=document.getElementById("currentGrade");async function y(){const{data:{session:e}}=await o.auth.getSession();if(!e){window.location.href="../auth/auth.html";return}const{data:t,error:a}=await o.from("user_profiles").select("*").eq("id",e.user.id).maybeSingle();if(a){console.error("Error loading profile:",a);return}if(!t){window.location.href="../auth/auth.html";return}if(t.account_type!=="student"){t.account_type==="parent"?window.location.href="parent-dashboard.html":t.account_type==="teacher"?window.location.href="teacher-dashboard.html":window.location.href="../index.html";return}w(t)}async function w(e){try{const t=e.first_name||e.full_name||e.username||"Hero";if(g.textContent=e.email||t,h.textContent=`Welcome back, ${t}!`,e.avatar_url)n.innerHTML=`<img src="${e.avatar_url}" alt="Avatar">`,r.innerHTML=`<img src="${e.avatar_url}" alt="Avatar">`;else if(e.first_name){const a=e.first_name.charAt(0).toUpperCase();n.textContent=a,r.innerHTML=`<div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #667eea, #764ba2); font-size: 36px; font-weight: 800; color: white; border-radius: 50%;">${a}</div>`}else n.innerHTML='<i class="fas fa-user"></i>',r.innerHTML='<i class="fas fa-user text-slate-400 text-4xl"></i>';e.grade_level&&(f.textContent=e.grade_level)}catch(t){console.error("Error loading profile:",t)}}c.addEventListener("click",e=>{e.stopPropagation(),s.classList.toggle("show")});document.addEventListener("click",e=>{!c.contains(e.target)&&!s.contains(e.target)&&s.classList.remove("show")});m.addEventListener("click",async()=>{try{const{error:e}=await o.auth.signOut();if(e)throw e;localStorage.clear(),sessionStorage.clear(),window.location.href="../auth/auth.html?type=student&mode=login"}catch(e){console.error("Logout error:",e),alert("Failed to logout. Please try again.")}});y();
