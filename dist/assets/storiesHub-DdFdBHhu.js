import"./config-ClyacVFi.js";import{getStoryList as E,logAnalyticsEvent as h,isUsingStoryMocks as L,getStoryProgressSummary as v}from"./story-services-DPdubSP2.js";import"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/+esm";const i=document.getElementById("storiesGrid"),d=document.getElementById("storyListEmpty"),c=document.getElementById("offlineBanner"),C=document.getElementById("storyCardTemplate");function l(){if(!c)return;const e=L()||navigator.onLine===!1;c.classList.toggle("hidden",!e)}function x(e){var s;const t=C.content.cloneNode(!0),r=t.querySelector("[data-cover]"),m=t.querySelector("[data-topic]"),u=t.querySelector("[data-title]"),y=t.querySelector("[data-summary]"),g=t.querySelector("[data-readingLevel]"),p=t.querySelector("[data-estimatedTime]"),o=t.querySelector("[data-progressLabel]"),f=t.querySelector("[data-openStory]");r.src=e.coverUrl||"/images/placeholder-story.png",r.alt=e.title,m.textContent=e.topicTag||"Science",u.textContent=e.title,y.textContent=e.summary||"Tap to open this adventure.",g.textContent=e.readingLevel||"Mixed Ages",p.textContent=e.estimatedTime||"5 min read";const n=v(e.id),a=((s=e.panels)==null?void 0:s.length)??e.panel_count??6;if(n!=null&&n.completedAt)o.textContent="Completed";else if((n==null?void 0:n.lastPanelIndex)>0){const S=Math.min(n.lastPanelIndex+1,a);o.textContent=`Panel ${S} of ${a}`}else o.textContent="Not started";return f.addEventListener("click",()=>{window.location.href=`./story.html?storyId=${encodeURIComponent(e.id)}`}),t}function w(e){if(i.innerHTML="",!e.length){d.classList.remove("hidden");return}d.classList.add("hidden"),e.forEach(t=>{i.appendChild(x(t))})}async function I(){try{const e=await E();w(e),await h("stories_list_viewed",{storyCount:e.length})}catch(e){console.error("[stories] Unable to load stories",e),i.innerHTML='<div class="col-span-2 text-center text-red-500 font-semibold">Unable to load stories right now.</div>'}}l();window.addEventListener("online",l);window.addEventListener("offline",l);I();
